#############################
# DEACTIVATED WORKFLOW FILE #
# Original: bump-version.yml (auto patch version bump)
# Reason: User requested total removal of all workflows.
# Date: 2025-10-08
# All triggers and jobs removed intentionally.
#############################
name: Auto Patch Version Bump

on:
  push:
    branches:
      - main
    # Avoid triggering on version-bump commits themselves using commit message filter (extra safeguard)
    paths-ignore:
      - '.github/workflows/bump-version.yml'
      - 'README.md'
      - 'README_*.md'

permissions:
  contents: write

concurrency:
  group: bump-version-${{ github.ref }}
  cancel-in-progress: false

jobs:
  bump:
    if: >-
      github.actor != 'github-actions[bot]' &&
      startsWith(github.ref, 'refs/heads/') &&
      github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Detect if last commit already changed VERSION (avoid loop)
        id: guard
        run: |
          set -euo pipefail
          if git diff-tree --no-commit-id --name-only -r "$GITHUB_SHA" | grep -q '^VERSION$'; then
            echo "changed=true" >> $GITHUB_OUTPUT
          else
            echo "changed=false" >> $GITHUB_OUTPUT
          fi
      - name: Stop early (already a version bump)
        if: steps.guard.outputs.changed == 'true'
        run: echo "VERSION already modified in this commit; skipping bump." && exit 0

      - name: Read current version & compute next patch
        id: bump
        run: |
          set -euo pipefail
          current=$(tr -d '\r\n' < VERSION)
          echo "Current version: $current"
          if [[ ! $current =~ ^([0-9]+)\.([0-9]+)\.([0-9]+)$ ]]; then
            echo "VERSION file does not contain simple semver MAJOR.MINOR.PATCH (e.g. 1.3.6). Aborting." >&2
            exit 1
          fi
          major=${BASH_REMATCH[1]}
          minor=${BASH_REMATCH[2]}
            patch=${BASH_REMATCH[3]}
          next_patch=$((patch+1))
          next="$major.$minor.$next_patch"
          echo "$next" > VERSION
          echo "Next version: $next"
          echo "next=$next" >> $GITHUB_OUTPUT
      - name: Commit & push new version
        env:
          NEXT_VERSION: ${{ steps.bump.outputs.next }}
        run: |
          set -euo pipefail
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          git add VERSION
          git commit -m "chore: bump version to $NEXT_VERSION [skip ci]" || {
            echo "No changes to commit (unexpected)."; exit 0; }
          git push origin HEAD:main
      - name: Output bumped version
        run: echo "Bumped to version ${{ steps.bump.outputs.next }}"