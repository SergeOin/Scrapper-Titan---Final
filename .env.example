# ==============================================
# Environment Variables Example
# Copy this file to .env and adjust values.
# NEVER commit your real .env.
# ==============================================

# -------- Core Application --------
APP_NAME=linkedin-scraper
LOG_LEVEL=INFO
LOG_FILE=logs/app.json.log            # Optional: enable file logging (comment to disable)
LOG_MAX_BYTES=2000000                 # Rotation max size bytes (~2MB)
LOG_BACKUP_COUNT=5                    # Number of rotated files to keep
SCRAPING_ENABLED=1               # 1 = enabled, 0 = disable all scraping activity
PLAYWRIGHT_HEADLESS=1            # 1 = headless browser, 0 = visible for debug
PLAYWRIGHT_MOCK_MODE=0           # 1 = génère des posts synthétiques (sans navigateur) pour tests
MAX_MOCK_POSTS=5                 # Limite de posts synthétiques par mot-clé en mode mock
AUTONOMOUS_WORKER_INTERVAL_SECONDS=900  # Si >0 le worker autonome périodique s'exécute (mock ou réel)
INPROCESS_AUTONOMOUS=0           # 1 = lancer le worker périodique DANS le serveur FastAPI (ex: Deta Space)
WORKER_RESTART_DELAY_SECONDS=5   # Délai avant relance en cas de crash du worker dédié
DASHBOARD_PUBLIC=1               # 1 = CORS large / pas d'auth interne (mettre 0 + activer INTERNAL_AUTH_* en prod)
CONCURRENCY_LIMIT=2              # Nombre maximum de jobs traités en parallèle (sémaphore)
PER_KEYWORD_DELAY_MS=500         # Délai ajouté entre deux mots-clés dans un même job
GLOBAL_RATE_LIMIT_PER_MIN=120    # Limite douce globale (placeholder token bucket)
RATE_LIMIT_BUCKET_SIZE=120       # Capacité max du bucket de jetons (hard ceiling)
RATE_LIMIT_REFILL_PER_SEC=2.0    # Jetons régénérés par seconde
MAX_POSTS_PER_KEYWORD=30         # Hard cap per keyword per run
MAX_SCROLL_STEPS=5               # Nombre max de scrolls supplémentaires par mot-clé
SCROLL_WAIT_MS=1200              # Attente après chaque scroll (ms)
MIN_POSTS_TARGET=10              # Objectif minimum avant d'arrêter si plus de croissance
CACHE_TTL_SECONDS=300            # In-memory TTL for lightweight caches (seconds)
LOCK_FILE=.scrape.lock           # File-based lock to avoid concurrent workers
EXPORT_DIR=exports               # Directory for CSV fallback exports

# -------- Keywords (semicolon separated) --------
# Liste métier juridique étendue
SCRAPE_KEYWORDS="Avocat collaborateur;Avocat associé;Avocat Counsel;Paralegal;Legal counsel;Juriste;Responsable juridique;Directeur Juridique;Notaire stagiaire;Notaire associé;Notaire salarié;Notaire assistant;Clerc de notaire;Rédacteur d’actes;Responsable fiscal;Directeur fiscal;Comptable taxateur;Formaliste"

# Booster keywords (génériques opportunités emploi) – déclenchés si ratio sous l'objectif quotidien
BOOSTER_KEYWORDS="recrute;offre;hiring;opportunité"
BOOSTER_ACTIVATE_RATIO=0.6      # Seuil d'activation (0.6 => active si <60% de DAILY_POST_TARGET)
RELAX_FILTERS_BELOW_TARGET=1    # Assouplir légèrement le threshold recrutement si loin de l'objectif

# Objectifs quotidiens
DAILY_POST_TARGET=50            # Objectif principal ferme
DAILY_POST_SOFT_TARGET=40       # Palier indicatif (peut être utilisé pour heuristiques internes)

# Ajustements de volume par mot-clé
MAX_POSTS_PER_KEYWORD=35        # (surclasse la valeur plus bas si doublon)
MAX_SCROLL_STEPS=6              # (surclasse valeur plus bas si doublon)
ADAPTIVE_SCROLL=1
ADAPTIVE_SCROLL_MAX=8
PER_KEYWORD_DELAY_MS=400        # Pacing un peu réduit vs défaut (500)
GLOBAL_RATE_LIMIT_PER_MIN=140   # Légèrement supérieur au défaut (120)
RATE_LIMIT_REFILL_PER_SEC=2.5

# -------- Redis (Queue + Cache) --------
REDIS_URL=redis://localhost:6379/0
REDIS_QUEUE_KEY=jobs:scrape
JOB_VISIBILITY_TIMEOUT=300        # Seconds before an unacked job is re-queued
JOB_POLL_INTERVAL=3               # Seconds between polling attempts when idle

# -------- SQLite (Primary Storage) --------
SQLITE_PATH=data/posts.sqlite3

# -------- CSV Fallback --------
CSV_FALLBACK_FILE=exports/fallback_posts.csv

# -------- Internal Auth (Optional) --------
# To enable, set INTERNAL_AUTH_USER and INTERNAL_AUTH_PASS_HASH (bcrypt hash)
INTERNAL_AUTH_USER=
INTERNAL_AUTH_PASS_HASH=
# Option simplifiée : mot de passe en clair (hash bcrypt généré au démarrage si PASS_HASH vide)
INTERNAL_AUTH_PASS=
# NOTE: Le runtime génère automatiquement un hash bcrypt si INTERNAL_AUTH_PASS est défini.
# Version bcrypt épinglée (3.2.2) pour compatibilité passlib 1.7.x. Ne pas mettre à jour vers 4.x sans test.
# Generate hash (example):
# python -c "from passlib.hash import bcrypt; print(bcrypt.hash('ChangeMe!'))"

# -------- Security / Rate Limiting (Basic Heuristics) --------
MIN_SLEEP_MS=900                  # Min sleep between page actions
MAX_SLEEP_MS=2500                 # Max sleep between page actions
RANDOM_UA_ROTATION=1              # 1 = rotate realistic User-Agent per run
STEALTH_ENABLED=0                 # Opt-in uniquement: active des scripts/args "stealth" dans le subprocess scraper

# -------- Metrics / Monitoring --------
ENABLE_METRICS=1                  # Expose /metrics endpoint

# -------- Timeouts / Retries --------
NAVIGATION_TIMEOUT_MS=15000
ELEMENT_TIMEOUT_MS=8000
MAX_RETRIES=4

# -------- Files / Artifacts --------
SCREENSHOT_DIR=screenshots
TRACE_DIR=traces
STORAGE_STATE=storage_state.json  # Playwright authenticated state file
LOGIN_INITIAL_WAIT_SECONDS=0      # Fenêtre (s) pour login manuel première navigation si non authentifié
STORAGE_STATE_B64=                # Variante base64 du contenu JSON de storage_state pour déploiement PaaS
# Si défini et que STORAGE_STATE (fichier) est absent, il sera décodé automatiquement au démarrage.

# -------- Scoring Heuristic Weights (0..1) --------
WEIGHT_LENGTH=0.4
WEIGHT_MEDIA=0.3
WEIGHT_KEYWORD_DENSITY=0.2
WEIGHT_LANG_MATCH=0.1

# -------- Language / Locale --------
DEFAULT_LANG=fr

# -------- Advanced (Usually Leave As Default) --------
HTTPX_TIMEOUT=15
DISABLE_SSL_VERIFY=0
TRIGGER_TOKEN=                 # Jeton partagé requis pour /trigger si défini
API_RATE_LIMIT_PER_MIN=60      # Requêtes par minute par IP (approx)
API_RATE_LIMIT_BURST=20        # Burst initial autorisé
RECRUITMENT_SIGNAL_THRESHOLD=0.25 # Seuil un peu plus bas pour capter davantage d'offres après nouvelle heuristique

# -------- Deployment (PaaS) --------
PORT=8000                      # Certains PaaS (Render/Railway) injectent PORT automatiquement
APP_HOST=0.0.0.0
APP_COMMIT=                    # (Optionnel) Injecté au build/deploy (git rev) pour /api/version
BUILD_TIMESTAMP=               # (Optionnel) Timestamp ISO UTC du build pour /api/version

# -------- Desktop (local-only) --------
DESKTOP_APP=0                  # 1 en mode desktop packagé (bind localhost + protections localhost)
DESKTOP_TRIGGER_KEY=           # (auto) secret par lancement utilisé pour protéger les endpoints localhost

# -------- Future Expansion (placeholders) --------
# OPENTELEMETRY_EXPORTER=
# SENTRY_DSN=

# ==============================================
# End of file
# ==============================================

# ==============================================
# LEGAL FILTER CONFIGURATION
# ==============================================
# Le filtre légal analyse chaque post et calcule deux scores:
# - Score de recrutement (signaux: "recrute", "CDI", "poste", etc.)
# - Score juridique (métiers: avocat, juriste, notaire, etc.)
# Un post est accepté SI:
# 1. score_recrutement >= LEGAL_FILTER_RECRUITMENT_THRESHOLD
# 2. score_juridique >= LEGAL_FILTER_LEGAL_THRESHOLD
# 3. Aucune exclusion n'est déclenchée

# -------- Activation du filtre --------
FILTER_LEGAL_POSTS_ONLY=true                    # Active/désactive le filtre complet

# -------- Seuils de scoring --------
# Plus le seuil est élevé, plus le filtre est strict
# Valeurs recommandées: recruitment=0.15-0.25, legal=0.20-0.30
LEGAL_FILTER_RECRUITMENT_THRESHOLD=0.15         # Min signal recrutement (0.15 = termes explicites requis)
LEGAL_FILTER_LEGAL_THRESHOLD=0.20               # Min métier juridique (0.20 = profession claire requise)

# -------- Exclusions automatiques --------
# Chaque exclusion peut être désactivée individuellement
LEGAL_FILTER_EXCLUDE_STAGE=true                 # Exclure stages, alternances, apprentissages
LEGAL_FILTER_EXCLUDE_FREELANCE=true             # Exclure freelance, missions, intérim
LEGAL_FILTER_EXCLUDE_OPENTOWORK=true            # Exclure les chercheurs d'emploi (#OpenToWork)
LEGAL_FILTER_EXCLUDE_PROMO=true                 # Exclure webinars, formations, événements
LEGAL_FILTER_EXCLUDE_AGENCIES=true              # Exclure cabinets de recrutement (Fed Legal, Hays, etc.)
LEGAL_FILTER_EXCLUDE_FOREIGN=true               # Exclure postes hors France (Suisse, Canada, etc.)
LEGAL_FILTER_EXCLUDE_NON_LEGAL=true             # Exclure métiers non-juridiques (marketing, finance, etc.)

# -------- Options de debug --------
LEGAL_FILTER_VERBOSE=true                       # Affiche les raisons d'exclusion dans les logs

# ==============================================
# EXEMPLES DE CONFIGURATION
# ==============================================
# 
# Configuration STRICT (moins de posts, haute qualité):
#   LEGAL_FILTER_RECRUITMENT_THRESHOLD=0.25
#   LEGAL_FILTER_LEGAL_THRESHOLD=0.30
#
# Configuration SOUPLE (plus de posts, filtrage de base):
#   LEGAL_FILTER_RECRUITMENT_THRESHOLD=0.10
#   LEGAL_FILTER_LEGAL_THRESHOLD=0.15
#
# Accepter les stages (pour un public junior):
#   LEGAL_FILTER_EXCLUDE_STAGE=false
#
# Accepter les posts internationaux:
#   LEGAL_FILTER_EXCLUDE_FOREIGN=false
#
# ==============================================
